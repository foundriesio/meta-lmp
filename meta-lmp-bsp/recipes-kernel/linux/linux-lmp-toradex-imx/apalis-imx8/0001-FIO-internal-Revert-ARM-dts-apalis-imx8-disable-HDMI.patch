From 9c87deef878371be9ace1cfe177a6e5c6ad3192a Mon Sep 17 00:00:00 2001
From: Oleksandr Suvorov <oleksandr.suvorov@foundries.io>
Date: Wed, 25 Aug 2021 20:09:14 +0300
Subject: [PATCH] [FIO internal] Revert "ARM: dts: apalis-imx8: disable HDMI
 interface"

This reverts commit e9261b8a65349cda45e4017d9e493fc7e7d3df8f.

FIO BSP doesn't support overlays so far, while Toradex moved enabling
all display/touch interfaces to overlays, disabling them in the main
device trees.
Revert disabling HDMI on Apalis-iMX8 to make HDMI working properly in
FIO BSP.

Signed-off-by: Oleksandr Suvorov <oleksandr.suvorov@foundries.io>
---

 .../boot/dts/freescale/imx8-apalis-eval.dtsi  | 58 +++++++++++++++++++
 .../dts/freescale/imx8-apalis-ixora-v1.1.dtsi | 58 +++++++++++++++++++
 .../boot/dts/freescale/imx8-apalis-v1.1.dtsi  |  9 ++-
 3 files changed, 124 insertions(+), 1 deletion(-)

diff --git a/arch/arm64/boot/dts/freescale/imx8-apalis-eval.dtsi b/arch/arm64/boot/dts/freescale/imx8-apalis-eval.dtsi
index 1eba84f0e89e..c0a74adb35ec 100644
--- a/arch/arm64/boot/dts/freescale/imx8-apalis-eval.dtsi
+++ b/arch/arm64/boot/dts/freescale/imx8-apalis-eval.dtsi
@@ -189,6 +189,60 @@ &gpu_3d1{
 	status = "okay";
 };
 
+/* Apalis HDMI1 */
+&hdmi {
+	status = "okay";
+};
+
+&hdmi_lpcg_apb {
+	status = "okay";
+};
+
+&hdmi_lpcg_apb_mux_csr {
+	status = "okay";
+};
+
+&hdmi_lpcg_apb_mux_ctrl {
+	status = "okay";
+};
+
+&hdmi_lpcg_gpio_ipg {
+	status = "okay";
+};
+
+&hdmi_lpcg_i2c0 {
+	status = "okay";
+};
+
+&hdmi_lpcg_i2s {
+	status = "okay";
+};
+
+&hdmi_lpcg_lis_ipg {
+	status = "okay";
+};
+
+&hdmi_lpcg_msi_hclk {
+	status = "okay";
+};
+
+&hdmi_lpcg_phy {
+	status = "okay";
+};
+
+&hdmi_lpcg_pwm_ipg {
+	status = "okay";
+};
+
+&hdmi_lpcg_pxl {
+	status = "okay";
+};
+
+/* Apalis I2C2 (DDC) */
+&i2c0 {
+	status = "okay";
+};
+
 /* Apalis I2C1 */
 &i2c2 {
 	status = "okay";
@@ -228,6 +282,10 @@ &irqsteer_csi1 {
 	status = "okay";
 };
 
+&irqsteer_hdmi {
+	status = "okay";
+};
+
 /* Apalis SPI1 */
 &lpspi0 {
 	status = "okay";
diff --git a/arch/arm64/boot/dts/freescale/imx8-apalis-ixora-v1.1.dtsi b/arch/arm64/boot/dts/freescale/imx8-apalis-ixora-v1.1.dtsi
index 49c800189e74..2fb8b103da80 100644
--- a/arch/arm64/boot/dts/freescale/imx8-apalis-ixora-v1.1.dtsi
+++ b/arch/arm64/boot/dts/freescale/imx8-apalis-ixora-v1.1.dtsi
@@ -219,6 +219,60 @@ &gpu_3d1{
 	status = "okay";
 };
 
+/* Apalis HDMI1 */
+&hdmi {
+	status = "okay";
+};
+
+&hdmi_lpcg_apb {
+	status = "okay";
+};
+
+&hdmi_lpcg_apb_mux_csr {
+	status = "okay";
+};
+
+&hdmi_lpcg_apb_mux_ctrl {
+	status = "okay";
+};
+
+&hdmi_lpcg_gpio_ipg {
+	status = "okay";
+};
+
+&hdmi_lpcg_i2c0 {
+	status = "okay";
+};
+
+&hdmi_lpcg_i2s {
+	status = "okay";
+};
+
+&hdmi_lpcg_lis_ipg {
+	status = "okay";
+};
+
+&hdmi_lpcg_msi_hclk {
+	status = "okay";
+};
+
+&hdmi_lpcg_phy {
+	status = "okay";
+};
+
+&hdmi_lpcg_pwm_ipg {
+	status = "okay";
+};
+
+&hdmi_lpcg_pxl {
+	status = "okay";
+};
+
+/* Apalis I2C2 (DDC) */
+&i2c0 {
+	status = "okay";
+};
+
 /* Apalis I2C1 */
 &i2c2 {
 	status = "okay";
@@ -283,6 +337,10 @@ &irqsteer_csi1 {
 	status = "okay";
 };
 
+&irqsteer_hdmi {
+	status = "okay";
+};
+
 /* Apalis SPI1 */
 &lpspi0 {
 	status = "okay";
diff --git a/arch/arm64/boot/dts/freescale/imx8-apalis-v1.1.dtsi b/arch/arm64/boot/dts/freescale/imx8-apalis-v1.1.dtsi
index 5540846e60d0..ae90c3f5ab9a 100644
--- a/arch/arm64/boot/dts/freescale/imx8-apalis-v1.1.dtsi
+++ b/arch/arm64/boot/dts/freescale/imx8-apalis-v1.1.dtsi
@@ -247,7 +247,14 @@ sound_hdmi: sound-hdmi {
 		hdmi-out;
 		model = "imx-audio-hdmi-tx";
 		protocol = <1>;
-		status = "disabled";
+	};
+
+	sound-hdmi-arc {
+		compatible = "fsl,imx-audio-spdif";
+		model = "imx-hdmi-arc";
+		spdif-controller = <&spdif1>;
+		spdif-in;
+		spdif-out;
 	};
 
 	sound-spdif {
-- 
2.39.2

