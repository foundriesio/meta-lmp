From 249cd116c3f94e6f9cdf4334a72ded8c079a4d29 Mon Sep 17 00:00:00 2001
From: Ricardo Salveti <ricardo@foundries.io>
Date: Mon, 3 Dec 2018 16:26:18 -0200
Subject: [PATCH 1/5] dockerd: daemon: use default system config when none is
 available

This allows the system image to provide a default daemon.json file while
still allowing the user to overwrite via /etc/docker/daemon.json.

Upstream-Status: Pending

Signed-off-by: Ricardo Salveti <ricardo@foundries.io>
Signed-off-by: Jose Quaresma <jose.quaresma@foundries.io>
---
 cmd/dockerd/daemon.go | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/cmd/dockerd/daemon.go b/cmd/dockerd/daemon.go
index 8e475d41f2..ce0c021072 100644
--- a/cmd/dockerd/daemon.go
+++ b/cmd/dockerd/daemon.go
@@ -554,6 +554,12 @@ func loadDaemonCliConfig(opts *daemonOptions) (*config.Config, error) {
 	}
 	opts.setDefaultOptions()
 
+	// UNIX: use default system daemon config file if provided is not available
+	defaultSystemDaemonConfigFile := "/usr/lib/docker/daemon.json"
+	if _, err := os.Stat(opts.configFile); os.IsNotExist(err) {
+		opts.configFile = defaultSystemDaemonConfigFile
+	}
+
 	conf := opts.daemonConfig
 	flags := opts.flags
 	conf.Debug = opts.Debug
-- 
2.50.1

