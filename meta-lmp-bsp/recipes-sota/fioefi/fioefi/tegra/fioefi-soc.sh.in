CAPSULE_FILE="tegra-bl.cap"
CAPSULE_PATH="${FIO_OSTREE_TARGET_SYSROOT}/usr/lib/firmware"
EFI_DIR=/boot/efi/EFI/UpdateCapsule

getenv_soc() {
	exit 0
}

setenv_soc() {
	rc=0
	if [ "${1}" = "bootupgrade_available" ]; then
		if [ -z "${FIO_OSTREE_TARGET_SYSROOT}" ]; then
			error_exit "FIO_OSTREE_TARGET_SYSROOT env variable should be set"
		fi
		if [ -e "$CAPSULE_PATH/$CAPSULE_FILE" ]; then
			mkdir -p $EFI_DIR
			cp $CAPSULE_PATH/$CAPSULE_FILE $EFI_DIR || rc=1
			oe4t-set-uefi-OSIndications || rc=1
		else
			error_exit "$CAPSULE_PATH/$CAPSULE_FILE doesn't exist"
		fi
	fi

	exit $rc
}
