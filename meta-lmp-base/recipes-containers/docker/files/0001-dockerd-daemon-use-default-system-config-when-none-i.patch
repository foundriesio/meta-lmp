From d6b65b4d6929af8b1b9e0adaa4945dd1b4b7872c Mon Sep 17 00:00:00 2001
From: Ricardo Salveti <ricardo@foundries.io>
Date: Mon, 3 Dec 2018 16:26:18 -0200
Subject: [PATCH 1/5] dockerd: daemon: use default system config when none is
 available

This allows the system image to provide a default daemon.json file while
still allowing the user to overwrite via /etc/docker/daemon.json.

Upstream-Status: Pending

Signed-off-by: Ricardo Salveti <ricardo@foundries.io>
Signed-off-by: Jose Quaresma <jose.quaresma@foundries.io>
---
 daemon/command/daemon.go | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/daemon/command/daemon.go b/daemon/command/daemon.go
index d25c5b05b0..0b5c97a2df 100644
--- a/daemon/command/daemon.go
+++ b/daemon/command/daemon.go
@@ -551,6 +551,12 @@ func loadDaemonCliConfig(opts *daemonOptions) (*config.Config, error) {
 	}
 	opts.setDefaultOptions()
 
+	// UNIX: use default system daemon config file if provided is not available
+	defaultSystemDaemonConfigFile := "/usr/lib/docker/daemon.json"
+	if _, err := os.Stat(opts.configFile); os.IsNotExist(err) {
+		opts.configFile = defaultSystemDaemonConfigFile
+	}
+
 	conf := opts.daemonConfig
 	flags := opts.flags
 	conf.Debug = opts.Debug
-- 
2.51.2

